%% LyX 2.2.2 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[a4paper,ngerman]{scrartcl}
\renewcommand{\rmdefault}{cmr}
\renewcommand{\sfdefault}{cmss}
\renewcommand{\ttdefault}{cmtt}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{array}
\usepackage{refstyle}
\usepackage{float}
\usepackage{enumitem}
\usepackage{amsmath}
\usepackage{euler}

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.

\AtBeginDocument{\providecommand\figref[1]{\ref{fig:#1}}}
\pdfpageheight\paperheight
\pdfpagewidth\paperwidth

\newcommand{\noun}[1]{\textsc{#1}}
%% Because html converters don't know tabularnewline
\providecommand{\tabularnewline}{\\}
\RS@ifundefined{subsecref}
  {\newref{subsec}{name = \RSsectxt}}
  {}
\RS@ifundefined{thmref}
  {\def\RSthmtxt{theorem~}\newref{thm}{name = \RSthmtxt}}
  {}
\RS@ifundefined{lemref}
  {\def\RSlemtxt{lemma~}\newref{lem}{name = \RSlemtxt}}
  {}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Textclass specific LaTeX commands.
\newlength{\lyxlabelwidth}      % auxiliary length 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.
\renewcommand\theenumi{\alph{enumi})}
\renewcommand{\labelenumi}{\alph{enumi})}
\renewcommand{\thesubsection}{\arabic{subsection}}%... from subsections
\usepackage[position=top,labelformat= simple]{subfig}
\renewcommand\thesubtable{\normalsize Schritt \arabic{subtable}:}
\usepackage{multirow}
\usepackage{isotope}
\usepackage{tikz-uml}
\usepackage[section]{placeins}
\flushbottom
\usepackage{geometry}
\geometry{a4paper}
\usepackage[headsepline]{scrpage2}
\pagestyle{scrheadings}
\clearscrheadfoot
\ohead{}
\ihead{\large Program t}
\chead{\large }
\cfoot[\large \pagemark]{\pagemark}
\usepackage{color}
\usetikzlibrary{circuits.ee.IEC}
%\usepackage{beramono}

\@ifundefined{showcaptionsetup}{}{%
 \PassOptionsToPackage{caption=false}{subfig}}
\usepackage{subfig}
\makeatother
\usepackage{babel}
\usepackage{listings}
\lstset{language=verilog,
basicstyle={\footnotesize\fontfamily{fvm}\selectfont},
commentstyle={\textit},
keywordstyle={\bfseries},
tabsize=4,
frame=leftline,
numbers=left,
numberstyle={\tiny}}

\begin{document}

\section*{Running program t on MIX}

We will run programm t of exercise 20 in chapter 1.3.2 TAOCP (p. 161) on MIX. Programm t controls the traffic signal at corner of Del Mare Boulevard and Berkeley Avenue. This project will connect LEDs directly to the X-Register and a push button to the  Overflow toggle. This will be done extending the fpga design and routing the appropriate signals to the GPIO connector at the back of MIX.


\subsection{Extending the fpga desing}

Make a copy of the folder \lstinline|rtl| and cd into it.

\subsubsection{mix.pcf}

mix.pcf defines the physical constraints. Add the following lines to define new signal wires.

Consult the datasheet \lstinline|pics/iCE40HX8K-EVB| to understand the meaning of \lstinline|E4|,\lstinline|B2|, ... .

\lstinputlisting{mix.pcf}

\subsubsection{mix.v}

Add the following lines to the hardware description file \lstinline|mix.v| to connect the Register rX with the traffic signals.

\lstinputlisting{mix1.v}

Find the code snipped that controls the overflow toggle and add the line commented with "\lstinline|# traffic signal button|". 

\lstinputlisting{mix2.v}

\subsection{rebuild and flash to iCE40HX8K-EVB}

Rebuild the fpga project and upload. Â¸\lstinline|apio clean| is needed, because otherwise the the preloaded memory will not be updated.
```
apio clean
apio build -v
apio upload
```

\textbf{Tipp}: change the welcome message to ensure the new rom file has been uploaded.

\begin{lstlisting}
apio clean
apio upload -v
\end{lstlisting}

\subsection{leds and button}
Connect leds and button (don't forget resistors) to the appropriate GPIO connectors as described in the \lstinline|mix.pcf| file.

\textbf{Caution}: pins 1,3,5 and 7 are "reserved" for the power supply and the USB serial connector.

\begin{center}
	\input{schaltung_gpio_led.cir}
\end{center}

\subsection{t.mixal}
Compile \lstinline|t.mixal|, upload to MIX and run the traffic signals.




\end{document}
